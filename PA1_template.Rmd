---
title: "Reproducible Research: Peer Assessment 1"
author: "Ben Kesseler"
date: "May 10, 2016"
output: 
        html_document:
                keep_md: true
---
First, some libraries need to be called, and some settings set.

```{r setup}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(knitr)
library(readr)
library(scales)
```

## Loading and preprocessing the data

The original file provided was *activity.zip*. This code assumes that file is
in the working directory. The code will check for the presence of *activity.csv*,
and if not found, unzip the file *activity.zip*.

The code will then read in *activity.csv*, and convert the interval to a time.

```{r unzip_and_process}
if (length(list.files(pattern="activity.csv")) == 0) {
        if (length(list.files(pattern="activity.zip")) == 0) {
                paste("Please put the file activity.zip in the working directory")
                } else {
                        unzip("activity.zip")
                        activity <- read_csv("activity.csv")
                        print("activity.zip found, unzipped, and read into item: activity")
                }
        } else {
                activity <- read_csv("activity.csv")        
                print("activity.csv found, read into item: activity")
                        
}

activity$time <- strptime(sprintf("%04d",activity$interval),format="%H%M")

```

## What is the mean total number of steps taken per day?

First, the code will calculate the number of total steps per day, and store the 
result in a new data frame.

```{r totalsteps}
activity.by.day <- aggregate(
        list(steps = activity$steps),
        by = list(date = activity$date),
        FUN =sum)
```

For this portion of the analysis, NA values are ignored.

```{r cleantotalsteps}
activity.by.day.clean <- subset(activity.by.day,!is.na(steps))
```

Next, a histrogram will be created to show the distribution of the total steps
per day.

```{r cleanhistogram,fig.align="center"}
ggplot(activity.by.day.clean,aes(steps))+
        geom_histogram(
                breaks=seq(min(activity.by.day.clean$steps,na.rm=TRUE),
                           max(activity.by.day.clean$steps,na.rm=TRUE),l=17),
                col="black",
                aes(fill=..count..)
                )+
        scale_fill_continuous("Count",low="green", high="dark green")+
        theme_bw()+
        stat_bin(
                breaks=seq(min(activity.by.day.clean$steps,na.rm=TRUE),
                           max(activity.by.day.clean$steps,na.rm=TRUE),l=17),
                geom="text", 
                aes(label=..count..), 
                vjust=-1)+
        expand_limits(y=c(0,13))+
        ggtitle("Distribution of Days with Various Total Daily Step Amounts")+
        labs(x="Total Daily Steps",y="Count of Days")
```

The mean and median of the total number of steps taken per day are:

```{r meanclean}
table.mean.and.median <- data.frame(Measurements = c("Mean","Median"),
                                    Values = c(
                                            mean(activity.by.day.clean$steps),
                                            median(activity.by.day.clean$steps)
                                    )
)
kable(table.mean.and.median)
```

## What is the average daily activity pattern?

The data must first be aggregated by interval, time must be added for
plotting, and the time at which the maximum average daily steps occurs 
calculated.

```{r intervalaggregation}
activity.by.interval <- aggregate(activity[,c("interval","steps")],
                                  by=list(activity$interval),
                                  FUN=mean,
                                  na.rm=TRUE)

activity.by.interval$time <- activity$time[1:288]

maximum.average.steps.time <- activity.by.interval$time[
        which(activity.by.interval$steps==max(activity.by.interval$steps))]
```

Now the code will plot the time series of average daily steps.

```{r averagesteps,fig.align="center",fig.width=10}
ggplot(activity.by.interval,aes(x=time,y=steps))+
        geom_line(color="blue")+
        theme_bw()+
        labs(x="Time Interval",y="Average Steps")+
        geom_vline(xintercept=as.numeric(maximum.average.steps.time))+
        scale_x_datetime(labels=date_format("%H:%M",tz="America/Los_Angeles"))+
        ggtitle("Average Steps throughout the Day, over all days")+
        annotate("text",
                 x = maximum.average.steps.time+600,
                 y = max(activity.by.interval$steps),
                 label = paste("Maximum Average Daily Steps of ",
                               format(max(activity.by.interval$steps),digits=4),
                               "steps occurs at ",
                               format(maximum.average.steps.time,"%-H:%M")),
                 hjust=0
        )

```

The 5-minute interval from 8:35AM - 8:40AM has the highest average number of 
steps:

```{r maximumaveragesteps}
format(max(activity.by.interval$steps),digits=4)

format(maximum.average.steps.time,"%-H:%M")
```

## Imputing missing values